#!/bin/bash

# File:   cache_filesystem
# Author: Marco Plaitano
# Date:   21 Jun 2023
# Brief:  Update filesystem database for locate command.

# Make sure that the script won't be executed more than once at a time.
_check_pid() {
    local PIDFILE
    PIDFILE="/tmp/$(basename $0).pid"
    if [[ -f "$PIDFILE" ]]; then
        pid=$(cat "$PIDFILE")
        # Process found, script already running.
        if ps -p "$pid" &>/dev/null ; then
            echo "Script already running." ; exit 1
        # Process not found, overwrite.
        else
            echo $$ > "$PIDFILE"
        fi
    # Script wasn't running, write its pid onto file.
    else
        echo $$ > "$PIDFILE"
    fi
}
_check_pid

killall locate &>/dev/null
echo "Updating locate database..."

updatedb --require-visibility 0 -o /tmp/locate.db
